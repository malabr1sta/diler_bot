ssh rusbid@rusbid-dev.oktend.com
K829xbPm6tfbwmh7

LwL5NLvJF3i11vNL

ssh rusbid@212.227.166.41

если у нас есть новая версия проекта:
убеждаемся что она без багов и лежит в dev
 
если были изменения в моделях, не забываем сделать миграции и обновить фикстуру, если надо
если изменения значительные, лучше удалить все старые миграции из дева и создать заново, накатить фикстуру для проверки
 
если нет, и новая миграция встает поверх старых - ок. надо чтобы она была также в деве.
убеждаемся что конфиг для nginx в деве стоит нормальный (длинный. локальная версия короче)
пушим в дев все возможные изменения с этой стадии (миграции, фикстура, конфиг)
 
заходим на сервер
заходим в папку с проектом
 
посмотреть где запущен django сервер:
ps auxw | grep runserver
когда видим где процесс, убиваем по его pid, например:
kill 7956
если надо:
    ps auxw | grep runmailer
    kill pid 
    ps auxw | grep celery
    kill pid
 
то же самое можно сделать с runmailer и другими командами, которые требуют перезапуска
 
в папке проекта выполняем команду poetry shell
 
ЕСЛИ ТРЕБУЕТСЯ ПОСТАВИТЬ АБСОЛЮТНО ВСЕ МИГРАЦИИ С НУЛЯ, ДЕЛАЕМ:
почистить базу, закрыв все коннекты к ней:
python manage.py reset_db -c
 
берем изменения с гитхаба: git pull origin dev
открывается редактор для мерджа, можно ничего не писать, закрываем его (вроде Ctrl+O и далее Ctrl+X - смотреть внизу)
 
выполняем manage.py migrate
выполняем manage.py loaddata initial_data.json
 
все должно встать. после этого пора запускать нужные нам процессы, используя nohup. все команды пишем в формате:
nohup ... &
если надо: nohup sudo docker-compose up &
nohup python manage.py runserver &
если надо:
nohup python manage.py runmailer &
если надо:
A
nohup celery -A backoffice worker --beat &
nohup celery -A backoffice worker --beat --loglevel=info >> celery.log &

http://rusbid-dev.oktend.com/admin/
debug-admin@rusbid.de
loladminxd098

sudo supervisorctl restart all

sudo vim /etc/redis/redis.conf
# requirepass foobared
sudo service redis-server restart
redis-cli
auth Rusbudl23Redis

DEEPL_TOKEN = 19c35d91-e155-6900-5680-07f76b455254:fx

root@31.129.45.124
POur4mlA0Avj

sudo wg-quick up /home/navamba/Documents/goloburdin_wb.conf
sudo wg-quick down /home/navamba/Documents/goloburdin_wb.conf
